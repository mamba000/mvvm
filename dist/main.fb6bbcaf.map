{"version":3,"sources":["js/dep.js","js/observer.js","js/watcher.js","js/compile.js","js/mvvm.js","js/main.js"],"names":["id","Dep","subs","uid","target","addDep","watcher","push","forEach","sub","update","prototype","Observer","data","observe","self","Object","keys","key","val","dep","observeInner","defineProperty","configurable","enumerable","get","depend","set","newVal","notify","Watcher","vm","node","depsId","value","oldVal","nodeValue","hasOwnProperty","addSub","REG","Compiler","el","$el","document","querySelector","compiler","parentNode","frag","createDocumentFragment","firstChild","nodeType","tagName","Array","from","attributes","attr","name","removeAttribute","addEventListener","e","childNodes","length","test","RegExp","$1","trim","parseKey","appendChild","res","split","Vue","options","Compliter","names","a","b","icon"],"mappings":"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","file":"main.fb6bbcaf.map","sourceRoot":"..","sourcesContent":["let id = 0\nexport default class Dep {\n  constructor () {\n    this.subs = []\n    this.uid = id++\n  }\n  depend () {\n    Dep.target.addDep(this)\n  }\n  addSub (watcher) {\n    this.subs.push(watcher)\n  }\n  notify () {\n    this.subs.forEach((sub) => {\n      sub.update && sub.update()\n    })\n  }\n}\n\nDep.prototype.target = null","import Dep from './dep'\nexport default class Observer {\n  constructor (data) {\n    this.data = data\n    this.observe()\n  }\n  observe () {\n    let self = this\n    let data = this.data\n    Object.keys(data).forEach((key) => {\n      let val = data[key]\n      let dep = new Dep()\n      this.observeInner(data[key])\n      Object.defineProperty(data, key, {\n        configurable: true,\n        enumerable: true,\n        get () {\n          if (Dep.target) {\n            dep.depend()\n          }\n          return val\n        },\n        set (newVal) {\n          if (val === newVal) {\n            return\n          }\n          val = newVal\n          self.observe(newVal)\n          dep.notify()\n        }\n      })\n    })\n  }\n  // 如果属性值为对象，继续劫持该值\n  observeInner (val) {\n    if (!val || typeof val !== 'object') {\n      return\n    }\n    return new Observer(val)\n  }\n}","import Dep from './dep'\nexport default class Watcher {\n  constructor (vm, key, node) {\n    this.vm = vm\n    this.key = key\n    this.node = node\n    this.depsId = {}\n    this.value = this.get()\n  }\n  get () {\n    Dep.target = this\n    var val = this.vm.data[this.key] // 获取当前watcher对应的属性的值\n    Dep.target = null\n    return val\n  }\n  update () {\n    let newVal = this.get()\n    let oldVal = this.value\n    if (newVal !== oldVal) {\n      this.node.nodeValue = this.vm.data[this.key]\n    }\n  }\n  addDep (dep) {\n    if (!this.depsId.hasOwnProperty(dep.uid)) {\n      this.depsId[dep.uid] = dep\n      dep.addSub(this)\n    }\n  }\n}","import Watcher from './watcher'\nconst REG = /\\{\\{(.*)\\}\\}/\n\nexport default class Compiler {\n  constructor (el, vm) {\n    this.vm = vm\n    this.$el = typeof el === 'object' ? el : document.querySelector(el)\n    this.compiler(this.$el)\n  }\n  compiler (parentNode) {\n    let frag = document.createDocumentFragment()\n    let $el = parentNode\n    let node = null\n    while(node = $el.firstChild) {\n      if (node.nodeType === 1) { // 元素节点\n        // 获取元素的标签名\n        let tagName = node.tagName\n        // 编译含有v-model的input或者textarea\n        Array.from(node.attributes).forEach((attr) => {\n          if ((tagName === 'INPUT' || tagName === 'TEXTAREA') && attr.name === 'v-model') {\n            let key = attr.value\n            node.value = this.vm.data[key]\n            node.removeAttribute(attr.name)\n            // 将表达式或指令与watcher一一对应\n            new Watcher(this.vm, key, node)\n\n            node.addEventListener('input', (e) => {\n              this.vm.data[key] = e.target.value\n            }, false)\n          }\n        })\n        if (node.childNodes.length) {\n          this.compiler(node)\n        }\n      } else if (node.nodeType === 3)  { // 文本节点\n        if (REG.test(node.nodeValue)) {\n          let key = RegExp.$1.trim()\n          this.parseKey(key)\n          node.nodeValue = this.vm.data[key]\n          // 将表达式或指令与watcher一一对应\n          new Watcher(this.vm, key, node)\n        }\n      }\n      frag.appendChild(node)\n    }\n    $el.appendChild(frag)\n  }\n  parseKey (key) {\n    let res = key.split('.')\n  }\n}","import Observer from './observer'\nimport Compliter from './compile'\nexport default class Vue {\n  constructor (options) {\n    this.data = options.data\n    this.el = options.el\n    // 数据劫持\n    new Observer(this.data)\n    // 模板编译\n    new Compliter(this.el, this)\n  }\n}","import Vue from './mvvm'\n\nconst vm = new Vue({\n  el: '#app',\n  data: {\n    name: 'abcsdf',\n    names: {\n      a: '哈哈',\n      b: '苦苦'\n    },\n    icon: '小妮啊',\n  }\n})"]}